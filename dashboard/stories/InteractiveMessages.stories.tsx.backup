import type { Meta, StoryObj } from '@storybook/react'
import { ChatFeedView, type ChatMessage } from '@/components/chat-feed'

/**
 * Interactive Messages - Chat messages that require user interaction
 *
 * This shows every possible variation of interactive chat messages:
 * - Different button types and layouts
 * - Single vs multiple input fields
 * - Text inputs vs textareas
 * - Optional vs required fields
 * - With/without header content
 * - Different button variants (default, secondary, destructive, outline, ghost)
 *
 * Each story shows the interactive message as it appears in the chat feed
 * with icon, badge, timestamp, and the interactive component.
 */
const meta = {
  title: 'Chat/Interactive Messages',
  component: ChatFeedView,
  parameters: {
    layout: 'fullscreen',
  },
  tags: ['autodocs'],
  decorators: [
    (Story) => (
      <div className="h-screen w-full bg-background">
        <Story />
      </div>
    ),
  ],
} satisfies Meta<typeof ChatFeedView>

export default meta
type Story = StoryObj<typeof meta>

// ============================================================================
// APPROVAL REQUESTS - Simple button choices
// ============================================================================

const timestamp = () => new Date().toISOString()

export const SimpleApproval: Story = {
  args: {
    messages: [{
      id: 'msg-1',
      content: '',
      role: 'SYSTEM',
      messageType: 'MESSAGE',
      humanInteraction: 'PENDING_APPROVAL',
      createdAt: timestamp(),
      metadata: {
        content: 'Deploy new score configuration **v2.1.5** to production?\n\nThis will affect 3 active scorecards.',
        buttons: [
          { label: 'Approve', value: 'approve', variant: 'default' },
          { label: 'Reject', value: 'reject', variant: 'destructive' },
        ],
      },
    }],
    isLoading: false,
  },
}

export const ThreeWayChoice: Story = {
  args: {
    metadata: {
      content: 'Evaluation completed with 72% accuracy (below target of 85%).\n\nWhat would you like to do?',
      buttons: [
        { label: 'Retry with adjusted parameters', value: 'retry', variant: 'default' },
        { label: 'Accept and deploy', value: 'accept', variant: 'secondary' },
        { label: 'Cancel', value: 'cancel', variant: 'outline' },
      ],
    },
  },
}

export const YesNoChoice: Story = {
  args: {
    metadata: {
      content: 'Continue with optimization?',
      buttons: [
        { label: 'Yes', value: 'yes', variant: 'default' },
        { label: 'No', value: 'no', variant: 'outline' },
      ],
    },
  },
}

// ============================================================================
// INPUT REQUESTS - Single field
// ============================================================================

export const SingleTextInput: Story = {
  args: {
    metadata: {
      content: 'Please provide the target accuracy threshold for the **Good Call** score.',
      inputs: [
        {
          name: 'accuracy_threshold',
          label: 'Target Accuracy (%)',
          placeholder: 'e.g., 85',
          required: true,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit', variant: 'default' },
        { label: 'Cancel', value: 'cancel', variant: 'outline' },
      ],
    },
  },
}

export const SingleTextareaInput: Story = {
  args: {
    metadata: {
      content: 'Please provide your analysis of the false positive patterns.',
      inputs: [
        {
          name: 'analysis',
          label: 'Analysis',
          description: 'Describe the patterns you observed and potential causes',
          placeholder: 'Enter your analysis here...',
          type: 'textarea',
          required: true,
        },
      ],
      buttons: [
        { label: 'Submit Analysis', value: 'submit', variant: 'default' },
        { label: 'Skip', value: 'skip', variant: 'ghost' },
      ],
    },
  },
}

export const OptionalInput: Story = {
  args: {
    metadata: {
      content: 'Add a comment about this evaluation run (optional).',
      inputs: [
        {
          name: 'comment',
          label: 'Comment',
          placeholder: 'Optional notes...',
          required: false,
        },
      ],
      buttons: [
        { label: 'Save', value: 'save', variant: 'default' },
        { label: 'Skip', value: 'skip', variant: 'outline' },
      ],
    },
  },
}

// ============================================================================
// MULTIPLE INPUTS - Complex forms
// ============================================================================

export const MultipleInputs: Story = {
  args: {
    metadata: {
      content: 'Configure the new evaluation run parameters.',
      inputs: [
        {
          name: 'scorecard_name',
          label: 'Scorecard Name',
          placeholder: 'e.g., CS3 Services v2',
          required: true,
        },
        {
          name: 'sample_size',
          label: 'Sample Size',
          description: 'Number of items to evaluate',
          placeholder: 'e.g., 500',
          required: true,
        },
        {
          name: 'notes',
          label: 'Notes',
          description: 'Optional notes about this evaluation',
          placeholder: 'Add any relevant context...',
          type: 'textarea',
          required: false,
        },
      ],
      buttons: [
        { label: 'Start Evaluation', value: 'start', variant: 'default' },
        { label: 'Cancel', value: 'cancel', variant: 'outline' },
      ],
    },
  },
}

export const DataCollectionForm: Story = {
  args: {
    metadata: {
      content: '## Hypothesis Configuration\n\nProvide details for the new hypothesis test.',
      inputs: [
        {
          name: 'hypothesis_name',
          label: 'Hypothesis Name',
          placeholder: 'e.g., Enhanced Greeting Detection',
          required: true,
        },
        {
          name: 'expected_improvement',
          label: 'Expected Improvement (%)',
          placeholder: 'e.g., 15',
          required: true,
        },
        {
          name: 'rationale',
          label: 'Rationale',
          description: 'Explain why you expect this improvement',
          placeholder: 'Describe the reasoning behind this hypothesis...',
          type: 'textarea',
          required: true,
        },
        {
          name: 'test_parameters',
          label: 'Test Parameters',
          description: 'Any special parameters for this test',
          placeholder: 'e.g., use_fine_tuned_model=true',
          required: false,
        },
      ],
      buttons: [
        { label: 'Create Hypothesis', value: 'create', variant: 'default' },
        { label: 'Save as Draft', value: 'draft', variant: 'secondary' },
        { label: 'Cancel', value: 'cancel', variant: 'ghost' },
      ],
    },
  },
}

// ============================================================================
// NO INPUTS - Buttons only (pure approval/selection)
// ============================================================================

export const ButtonsOnly: Story = {
  args: {
    metadata: {
      content: '## Review Required\n\nThe false positive analysis has identified **12 patterns**.\n\n- 5 greeting-related mismatches\n- 4 timing issues\n- 3 context problems\n\nPlease review the detailed analysis.',
      buttons: [
        { label: 'Approve Findings', value: 'approve', variant: 'default' },
        { label: 'Request Changes', value: 'changes', variant: 'secondary' },
        { label: 'Reject', value: 'reject', variant: 'destructive' },
      ],
    },
  },
}

export const MinimalButtons: Story = {
  args: {
    metadata: {
      buttons: [
        { label: 'Confirm', value: 'confirm', variant: 'default' },
        { label: 'Cancel', value: 'cancel', variant: 'outline' },
      ],
    },
  },
}

// ============================================================================
// NO BUTTONS - Inputs only (rare, but possible)
// ============================================================================

export const InputsOnlyAutoSubmit: Story = {
  args: {
    metadata: {
      content: 'Quick feedback (press Enter to submit)',
      inputs: [
        {
          name: 'feedback',
          label: 'Feedback',
          placeholder: 'Type your feedback...',
          required: true,
        },
      ],
      // No buttons - could auto-submit on Enter
    },
  },
}

// ============================================================================
// DISABLED STATE
// ============================================================================

export const DisabledState: Story = {
  args: {
    metadata: {
      content: 'This request has already been processed.',
      inputs: [
        {
          name: 'comment',
          label: 'Comment',
          placeholder: 'Previously entered: Looks good',
        },
      ],
      buttons: [
        { label: 'Approved', value: 'approved', variant: 'default' },
      ],
    },
    disabled: true,
  },
}

// ============================================================================
// EDGE CASES
// ============================================================================

export const NoContent: Story = {
  args: {
    metadata: {
      inputs: [
        {
          name: 'input',
          label: 'Input',
          placeholder: 'Enter value',
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit' },
      ],
    },
  },
}

export const LongContent: Story = {
  args: {
    metadata: {
      content: `# Detailed Analysis Report

## Executive Summary
The current score configuration has been running for 3 weeks with the following results:
- **Overall Accuracy**: 87.3%
- **Precision**: 85.2%
- **Recall**: 89.4%
- **F1 Score**: 87.2%

## Key Findings

### 1. Greeting Detection
- Successfully identifies 94% of standard greetings
- Struggles with informal variations (72% accuracy)
- Time-of-day greetings performing well (91% accuracy)

### 2. Context Awareness
- Improved from baseline by 15%
- Still missing some nuanced contexts
- Conversation history integration working as expected

### 3. Areas for Improvement
1. Handle informal greetings better
2. Improve handling of regional variations
3. Better detection of implied greetings

## Recommendation
Deploy to production with monitoring enabled for informal greeting patterns.`,
      buttons: [
        { label: 'Approve Deployment', value: 'approve', variant: 'default' },
        { label: 'Request More Analysis', value: 'more_analysis', variant: 'secondary' },
        { label: 'Reject', value: 'reject', variant: 'destructive' },
      ],
    },
  },
}

// ============================================================================
// BUTTON VARIANTS - Testing all button types
// ============================================================================

export const ButtonVariantsDefault: Story = {
  args: {
    metadata: {
      content: 'Testing **default** button variant (primary action)',
      buttons: [
        { label: 'Default Button', value: 'default', variant: 'default' },
      ],
    },
  },
}

export const ButtonVariantsSecondary: Story = {
  args: {
    metadata: {
      content: 'Testing **secondary** button variant (less prominent action)',
      buttons: [
        { label: 'Secondary Button', value: 'secondary', variant: 'secondary' },
      ],
    },
  },
}

export const ButtonVariantsDestructive: Story = {
  args: {
    metadata: {
      content: 'Testing **destructive** button variant (dangerous action)',
      buttons: [
        { label: 'Delete', value: 'delete', variant: 'destructive' },
      ],
    },
  },
}

export const ButtonVariantsOutline: Story = {
  args: {
    metadata: {
      content: 'Testing **outline** button variant (cancel action)',
      buttons: [
        { label: 'Cancel', value: 'cancel', variant: 'outline' },
      ],
    },
  },
}

export const ButtonVariantsGhost: Story = {
  args: {
    metadata: {
      content: 'Testing **ghost** button variant (subtle action)',
      buttons: [
        { label: 'Skip', value: 'skip', variant: 'ghost' },
      ],
    },
  },
}

export const ButtonVariantsMixed: Story = {
  args: {
    metadata: {
      content: 'Testing all button variants together',
      buttons: [
        { label: 'Primary', value: 'primary', variant: 'default' },
        { label: 'Secondary', value: 'secondary', variant: 'secondary' },
        { label: 'Destructive', value: 'destructive', variant: 'destructive' },
        { label: 'Outline', value: 'outline', variant: 'outline' },
        { label: 'Ghost', value: 'ghost', variant: 'ghost' },
      ],
    },
  },
}

// ============================================================================
// WITH/WITHOUT HEADER - Content visibility
// ============================================================================

export const WithoutHeader: Story = {
  args: {
    metadata: {
      // No content property
      buttons: [
        { label: 'Yes', value: 'yes', variant: 'default' },
        { label: 'No', value: 'no', variant: 'outline' },
      ],
    },
  },
}

export const WithShortHeader: Story = {
  args: {
    metadata: {
      content: 'Quick question: Continue?',
      buttons: [
        { label: 'Yes', value: 'yes', variant: 'default' },
        { label: 'No', value: 'no', variant: 'outline' },
      ],
    },
  },
}

export const WithMarkdownHeader: Story = {
  args: {
    metadata: {
      content: '## Important Decision\n\nThis action will:\n- Delete all existing data\n- Reset configurations\n- Require re-initialization\n\n**This cannot be undone.**',
      buttons: [
        { label: 'I Understand, Proceed', value: 'proceed', variant: 'destructive' },
        { label: 'Cancel', value: 'cancel', variant: 'outline' },
      ],
    },
  },
}

// ============================================================================
// BUTTON COUNT VARIATIONS
// ============================================================================

export const OneButton: Story = {
  args: {
    metadata: {
      content: 'Single button (confirmation)',
      buttons: [
        { label: 'Okay', value: 'okay', variant: 'default' },
      ],
    },
  },
}

export const TwoButtons: Story = {
  args: {
    metadata: {
      content: 'Two buttons (yes/no)',
      buttons: [
        { label: 'Confirm', value: 'confirm', variant: 'default' },
        { label: 'Cancel', value: 'cancel', variant: 'outline' },
      ],
    },
  },
}

export const FourButtons: Story = {
  args: {
    metadata: {
      content: 'Four button choices',
      buttons: [
        { label: 'Option A', value: 'a', variant: 'default' },
        { label: 'Option B', value: 'b', variant: 'secondary' },
        { label: 'Option C', value: 'c', variant: 'outline' },
        { label: 'Cancel', value: 'cancel', variant: 'ghost' },
      ],
    },
  },
}

export const ManyButtons: Story = {
  args: {
    metadata: {
      content: 'Many button choices (should wrap)',
      buttons: [
        { label: 'Choice 1', value: '1', variant: 'default' },
        { label: 'Choice 2', value: '2', variant: 'secondary' },
        { label: 'Choice 3', value: '3', variant: 'secondary' },
        { label: 'Choice 4', value: '4', variant: 'secondary' },
        { label: 'Choice 5', value: '5', variant: 'secondary' },
        { label: 'Cancel', value: 'cancel', variant: 'outline' },
      ],
    },
  },
}

// ============================================================================
// INPUT COUNT VARIATIONS  
// ============================================================================

export const OneInputField: Story = {
  args: {
    metadata: {
      content: 'Single input field',
      inputs: [
        {
          name: 'value',
          label: 'Value',
          placeholder: 'Enter value here',
          required: true,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit', variant: 'default' },
      ],
    },
  },
}

export const TwoInputFields: Story = {
  args: {
    metadata: {
      content: 'Two input fields',
      inputs: [
        {
          name: 'first',
          label: 'First Value',
          placeholder: 'Enter first value',
          required: true,
        },
        {
          name: 'second',
          label: 'Second Value',
          placeholder: 'Enter second value',
          required: true,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit', variant: 'default' },
      ],
    },
  },
}

export const ThreeInputFields: Story = {
  args: {
    metadata: {
      content: 'Three input fields',
      inputs: [
        {
          name: 'name',
          label: 'Name',
          placeholder: 'Your name',
          required: true,
        },
        {
          name: 'email',
          label: 'Email',
          placeholder: 'your@email.com',
          required: true,
        },
        {
          name: 'phone',
          label: 'Phone',
          placeholder: '(555) 123-4567',
          required: false,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit', variant: 'default' },
      ],
    },
  },
}

// ============================================================================
// TEXT INPUT vs TEXTAREA  
// ============================================================================

export const OnlyTextInput: Story = {
  args: {
    metadata: {
      content: 'Single line text input',
      inputs: [
        {
          name: 'short_answer',
          label: 'Short Answer',
          placeholder: 'Type a brief answer...',
          type: 'text',
          required: true,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit' },
      ],
    },
  },
}

export const OnlyTextarea: Story = {
  args: {
    metadata: {
      content: 'Multi-line text area',
      inputs: [
        {
          name: 'long_answer',
          label: 'Detailed Answer',
          description: 'Provide a comprehensive response',
          placeholder: 'Type your detailed answer here...',
          type: 'textarea',
          required: true,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit' },
      ],
    },
  },
}

export const MixedInputTypes: Story = {
  args: {
    metadata: {
      content: 'Mix of input types',
      inputs: [
        {
          name: 'title',
          label: 'Title',
          placeholder: 'Brief title',
          type: 'text',
          required: true,
        },
        {
          name: 'description',
          label: 'Description',
          placeholder: 'Detailed description...',
          type: 'textarea',
          required: true,
        },
        {
          name: 'tags',
          label: 'Tags',
          placeholder: 'comma, separated, tags',
          type: 'text',
          required: false,
        },
      ],
      buttons: [
        { label: 'Create', value: 'create', variant: 'default' },
        { label: 'Save Draft', value: 'draft', variant: 'secondary' },
      ],
    },
  },
}

// ============================================================================
// REQUIRED vs OPTIONAL FIELDS
// ============================================================================

export const AllRequiredFields: Story = {
  args: {
    metadata: {
      content: 'All fields are required (*)',
      inputs: [
        {
          name: 'field1',
          label: 'Required Field 1',
          placeholder: 'Must fill this',
          required: true,
        },
        {
          name: 'field2',
          label: 'Required Field 2',
          placeholder: 'Must fill this too',
          required: true,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit' },
      ],
    },
  },
}

export const AllOptionalFields: Story = {
  args: {
    metadata: {
      content: 'All fields are optional',
      inputs: [
        {
          name: 'field1',
          label: 'Optional Field 1',
          placeholder: 'Optional',
          required: false,
        },
        {
          name: 'field2',
          label: 'Optional Field 2',
          placeholder: 'Also optional',
          required: false,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit' },
        { label: 'Skip All', value: 'skip', variant: 'ghost' },
      ],
    },
  },
}

export const MixedRequiredOptional: Story = {
  args: {
    metadata: {
      content: 'Some required, some optional',
      inputs: [
        {
          name: 'required_field',
          label: 'Required Field',
          description: 'This field must be filled',
          placeholder: 'Required',
          required: true,
        },
        {
          name: 'optional_field',
          label: 'Optional Field',
          description: 'This field is optional',
          placeholder: 'Optional',
          required: false,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit' },
      ],
    },
  },
}

// ============================================================================
// WITH/WITHOUT FIELD DESCRIPTIONS
// ============================================================================

export const WithDescriptions: Story = {
  args: {
    metadata: {
      content: 'All inputs have helpful descriptions',
      inputs: [
        {
          name: 'accuracy',
          label: 'Target Accuracy',
          description: 'The minimum acceptable accuracy percentage (0-100)',
          placeholder: '85',
          required: true,
        },
        {
          name: 'sample_size',
          label: 'Sample Size',
          description: 'Number of items in the test evaluation run',
          placeholder: '500',
          required: true,
        },
      ],
      buttons: [
        { label: 'Run Test', value: 'run' },
      ],
    },
  },
}

export const WithoutDescriptions: Story = {
  args: {
    metadata: {
      content: 'Simple inputs without descriptions',
      inputs: [
        {
          name: 'name',
          label: 'Name',
          placeholder: 'Enter name',
          required: true,
        },
        {
          name: 'value',
          label: 'Value',
          placeholder: 'Enter value',
          required: true,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit' },
      ],
    },
  },
}

// ============================================================================
// PLACEHOLDER TEXT VARIATIONS
// ============================================================================

export const DetailedPlaceholders: Story = {
  args: {
    metadata: {
      content: 'Inputs with detailed placeholder guidance',
      inputs: [
        {
          name: 'scorecard',
          label: 'Scorecard Name',
          placeholder: 'e.g., "CS3 Services v2" or "Healthcare Quality Metrics"',
          required: true,
        },
        {
          name: 'threshold',
          label: 'Confidence Threshold',
          placeholder: 'Enter a value between 0.0 and 1.0 (e.g., 0.85)',
          required: true,
        },
      ],
      buttons: [
        { label: 'Apply', value: 'apply' },
      ],
    },
  },
}

export const MinimalPlaceholders: Story = {
  args: {
    metadata: {
      content: 'Inputs with minimal placeholders',
      inputs: [
        {
          name: 'name',
          label: 'Name',
          placeholder: 'Name...',
          required: true,
        },
        {
          name: 'value',
          label: 'Value',
          placeholder: 'Value...',
          required: true,
        },
      ],
      buttons: [
        { label: 'Submit', value: 'submit' },
      ],
    },
  },
}
