<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Getting Started - Plexus Procedure DSL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header .breadcrumb {
            opacity: 0.9;
        }

        .header .breadcrumb a {
            color: white;
            text-decoration: none;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        .content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        h2 {
            color: #667eea;
            margin: 2rem 0 1rem 0;
            font-size: 1.8rem;
        }

        h3 {
            color: #764ba2;
            margin: 1.5rem 0 0.5rem 0;
            font-size: 1.3rem;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .tip-box {
            background: #f1f8e9;
            border-left: 4px solid #8bc34a;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        code {
            background: #f4f4f4;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }

        .step {
            background: #f9f9f9;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .step h3 {
            margin-top: 0;
        }

        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }

        li {
            margin: 0.5rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .nav-links {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #ddd;
        }

        .nav-links a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .nav-links a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="breadcrumb">
            <a href="index.html">Documentation</a> / Getting Started
        </div>
        <h1>Getting Started with Plexus Procedures</h1>
    </div>

    <div class="container">
        <div class="content">
            <h2>Introduction</h2>
            <p>
                Welcome to Plexus Procedures! This guide will walk you through creating your first agentic workflow
                using the Procedure DSL. By the end, you'll understand how to define procedures, configure agents,
                and orchestrate workflows with Lua.
            </p>

            <h2>What You'll Learn</h2>
            <ul>
                <li>Core concepts: procedures, agents, workflows</li>
                <li>Creating your first procedure</li>
                <li>Working with parameters and outputs</li>
                <li>Orchestrating agent turns</li>
                <li>Managing state and stages</li>
                <li>Invoking other procedures</li>
            </ul>

            <h2>Core Concepts</h2>

            <h3>Procedures</h3>
            <p>
                A <strong>procedure</strong> is a reusable unit of agentic work defined in YAML. It has:
            </p>
            <ul>
                <li><strong>Parameters:</strong> Typed inputs validated before execution</li>
                <li><strong>Outputs:</strong> Typed results validated after execution</li>
                <li><strong>Agents:</strong> LLM workers that execute tasks</li>
                <li><strong>Workflow:</strong> Lua orchestration code</li>
                <li><strong>State:</strong> Mutable storage for tracking progress</li>
            </ul>

            <h3>Agents</h3>
            <p>
                <strong>Agents</strong> are configured LLM instances. Each agent has:
            </p>
            <ul>
                <li>A system prompt (can use templates)</li>
                <li>Available tools (including other procedures)</li>
                <li>Response filtering and retry configuration</li>
            </ul>
            <p>
                When you define an agent named <code>worker</code>, you get a Lua primitive <code>Worker.turn()</code>
                that executes one agentic turn.
            </p>

            <h3>Workflows</h3>
            <p>
                The <strong>workflow</strong> contains Lua code that orchestrates execution:
            </p>
            <ul>
                <li>Call agent turns: <code>Worker.turn()</code></li>
                <li>Manage state: <code>State.set("key", value)</code></li>
                <li>Control flow: loops, conditionals</li>
                <li>Invoke other procedures: <code>Procedure.run(name, params)</code></li>
                <li>Return results: <code>return {result = "done"}</code></li>
            </ul>

            <h2>Your First Procedure</h2>

            <div class="step">
                <h3>Step 1: Create a Simple Procedure</h3>
                <p>Let's create a procedure that greets a user:</p>
                <div class="code-block">name: greeter
version: 1.0.0
description: A simple greeting procedure

params:
  name:
    type: string
    required: true

outputs:
  greeting:
    type: string
    required: true

agents:
  assistant:
    system_prompt: |
      You are a friendly assistant.
      Greet the user named {params.name}.
    tools:
      - done

workflow: |
  Assistant.turn()
  return {greeting = "Hello, " .. params.name .. "!"}</div>
            </div>

            <div class="info-box">
                <strong>What's happening here:</strong>
                <ul>
                    <li><code>params</code> defines a required string parameter <code>name</code></li>
                    <li><code>outputs</code> defines a required string output <code>greeting</code></li>
                    <li><code>agents</code> defines an assistant with a templated system prompt</li>
                    <li><code>workflow</code> calls one agent turn and returns a result</li>
                </ul>
            </div>

            <div class="step">
                <h3>Step 2: Add Control Flow</h3>
                <p>Let's make the agent loop until it's done:</p>
                <div class="code-block">name: researcher
version: 1.0.0
description: Research a topic

params:
  topic:
    type: string
    required: true

outputs:
  summary:
    type: string
    required: true

agents:
  worker:
    system_prompt: |
      Research the topic: {params.topic}
      Use the search tool to find information.
      When done, call the done tool.
    tools:
      - search
      - done

workflow: |
  -- Loop until done
  repeat
    Worker.turn()
  until Tool.called("done") or Iterations.exceeded(10)

  return {summary = State.get("summary") or "No summary available"}</div>
            </div>

            <div class="info-box">
                <strong>New concepts:</strong>
                <ul>
                    <li><code>repeat...until</code> creates a control loop</li>
                    <li><code>Tool.called("done")</code> checks if agent called the done tool</li>
                    <li><code>Iterations.exceeded(10)</code> prevents infinite loops</li>
                    <li><code>State.get("summary")</code> retrieves agent's stored summary</li>
                </ul>
            </div>

            <div class="step">
                <h3>Step 3: Use State for Tracking</h3>
                <p>Track progress across turns:</p>
                <div class="code-block">name: data_processor
version: 1.0.0
description: Process a list of items

params:
  items:
    type: array
    required: true

outputs:
  processed_count:
    type: number
    required: true

agents:
  processor:
    system_prompt: |
      Process items one at a time.
      Processed so far: {state.count}
    tools:
      - process_item
      - done

workflow: |
  -- Initialize state
  State.set("count", 0)

  -- Process each item
  for i, item in ipairs(params.items) do
    Worker.turn({inject = "Process: " .. item})
    State.increment("count")
  end

  return {processed_count = State.get("count")}</div>
            </div>

            <div class="info-box">
                <strong>State management:</strong>
                <ul>
                    <li><code>State.set(key, value)</code> stores a value</li>
                    <li><code>State.increment(key)</code> increments a number</li>
                    <li><code>State.get(key)</code> retrieves a value</li>
                    <li>State is available in templates: <code>{state.count}</code></li>
                </ul>
            </div>

            <h2>Working with Parameters</h2>

            <h3>Parameter Types</h3>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>string</code></td>
                        <td>Text value</td>
                        <td><code>"hello world"</code></td>
                    </tr>
                    <tr>
                        <td><code>number</code></td>
                        <td>Numeric value</td>
                        <td><code>42</code></td>
                    </tr>
                    <tr>
                        <td><code>boolean</code></td>
                        <td>True or false</td>
                        <td><code>true</code></td>
                    </tr>
                    <tr>
                        <td><code>array</code></td>
                        <td>List of values</td>
                        <td><code>["a", "b", "c"]</code></td>
                    </tr>
                    <tr>
                        <td><code>object</code></td>
                        <td>Key-value pairs</td>
                        <td><code>{key: "value"}</code></td>
                    </tr>
                </tbody>
            </table>

            <h3>Parameter Options</h3>
            <div class="code-block">params:
  topic:
    type: string
    required: true          # Must be provided
    description: "The research topic"

  depth:
    type: string
    enum: [shallow, deep]   # Must be one of these
    default: shallow        # Used if not provided

  max_results:
    type: number
    default: 10</div>

            <h2>Working with Outputs</h2>

            <p>Outputs define what your procedure returns and are validated after execution:</p>

            <div class="code-block">outputs:
  findings:
    type: string
    required: true        # Must be present in return value

  confidence:
    type: string
    enum: [high, medium, low]
    required: true

  sources:
    type: array
    required: false       # Optional

workflow: |
  Worker.turn()

  return {
    findings = State.get("findings"),
    confidence = "high",
    sources = State.get("sources") or {}
  }</div>

            <div class="tip-box">
                <strong>Tip:</strong> If you omit the <code>outputs</code> section entirely,
                your workflow can return anything without validation. This is useful for
                prototyping or when output structure is dynamic.
            </div>

            <h2>Stages for Status Tracking</h2>

            <p>Stages provide high-level status for multi-phase workflows:</p>

            <div class="code-block">name: analyzer
version: 1.0.0

stages:
  - loading
  - analyzing
  - reporting

agents:
  worker:
    system_prompt: "Analyze data. Stage: {state.current_stage}"
    tools: [analyze, done]

workflow: |
  Stage.set("loading")
  load_data()

  Stage.set("analyzing")
  repeat
    Worker.turn()
  until Tool.called("done")

  Stage.set("reporting")
  generate_report()

  return {status = "complete"}</div>

            <div class="info-box">
                <strong>Stage operations:</strong>
                <ul>
                    <li><code>Stage.set("name")</code> - Set current stage</li>
                    <li><code>Stage.current()</code> - Get current stage name</li>
                    <li><code>Stage.is("name")</code> - Check if in specific stage</li>
                    <li>Stages are visible to monitoring systems</li>
                </ul>
            </div>

            <h2>Invoking Other Procedures</h2>

            <p>Procedures can invoke other procedures to compose workflows:</p>

            <h3>Synchronous Invocation</h3>
            <div class="code-block">workflow: |
  -- Call another procedure and wait for result
  local research = Procedure.run("researcher", {
    topic = params.topic
  })

  Log.info("Research complete: " .. research.summary)</div>

            <h3>Asynchronous Invocation</h3>
            <div class="code-block">workflow: |
  -- Spawn procedure in background
  local handle = Procedure.spawn("researcher", {
    topic = params.topic
  })

  -- Do other work
  do_something_else()

  -- Wait for result
  local research = Procedure.wait(handle)
  Log.info("Research complete: " .. research.summary)</div>

            <h3>Parallel Execution</h3>
            <div class="code-block">workflow: |
  -- Spawn multiple procedures
  local handles = {}
  for _, topic in ipairs(params.topics) do
    local handle = Procedure.spawn("researcher", {topic = topic})
    table.insert(handles, handle)
  end

  -- Wait for all to complete
  Procedure.wait_all(handles)

  -- Collect results
  local results = {}
  for _, handle in ipairs(handles) do
    table.insert(results, Procedure.result(handle))
  end</div>

            <h2>Guards for Validation</h2>

            <p>Guards validate conditions before execution starts:</p>

            <div class="code-block">name: file_processor
version: 1.0.0

params:
  file_path:
    type: string
    required: true

guards:
  - |
    -- Check file exists
    if not File.exists(params.file_path) then
      return false, "File not found: " .. params.file_path
    end
    return true

  - |
    -- Check file is readable
    local content, err = File.read(params.file_path)
    if not content then
      return false, "Cannot read file: " .. err
    end
    return true

workflow: |
  -- Guards passed, proceed safely
  local content = File.read(params.file_path)
  Worker.turn({inject = "Process: " .. content})</div>

            <div class="info-box">
                <strong>Guard rules:</strong>
                <ul>
                    <li>Guards run before workflow execution</li>
                    <li>Return <code>true</code> to proceed</li>
                    <li>Return <code>false, "message"</code> to abort</li>
                    <li>Guards have access to <code>params</code>, file operations, and environment variables</li>
                    <li>Guards do NOT have access to agents or state</li>
                </ul>
            </div>

            <h2>Error Handling</h2>

            <p>Use Lua's <code>pcall</code> for error handling:</p>

            <div class="code-block">workflow: |
  local ok, result = pcall(function()
    Worker.turn()
    return State.get("result")
  end)

  if not ok then
    Log.error("Operation failed: " .. tostring(result))
    return {success = false, error = result}
  end

  return {success = true, result = result}</div>

            <h3>Retry with Backoff</h3>
            <div class="code-block">workflow: |
  local result = Retry.with_backoff(function()
    return risky_operation()
  end, {
    max_attempts = 3,
    initial_delay = 1.0,
    multiplier = 2.0  -- 1s, 2s, 4s delays
  })</div>

            <h2>Summarization Prompts</h2>

            <p>Control how procedures communicate results:</p>

            <div class="code-block">name: analyzer
version: 1.0.0

return_prompt: |
  Summarize your analysis:
  - Key findings
  - Confidence level
  - Recommendations

error_prompt: |
  Explain what went wrong:
  - What you were trying to do
  - The error that occurred
  - Any partial progress

status_prompt: |
  Provide a brief progress update:
  - What's been completed
  - Current activity
  - Remaining work

workflow: |
  Worker.turn()
  -- return_prompt is automatically injected at end</div>

            <div class="info-box">
                <strong>When prompts run:</strong>
                <ul>
                    <li><code>return_prompt</code> - On successful completion</li>
                    <li><code>error_prompt</code> - On error or max iterations</li>
                    <li><code>status_prompt</code> - When status is requested (async procedures)</li>
                </ul>
            </div>

            <h2>Complete Example</h2>

            <p>Putting it all together:</p>

            <div class="code-block">name: content_analyzer
version: 1.0.0
description: Analyze content through multiple stages

params:
  content:
    type: string
    required: true
  depth:
    type: string
    enum: [quick, thorough]
    default: quick

outputs:
  score:
    type: number
    required: true
  insights:
    type: array
    required: true

stages:
  - analyzing
  - scoring
  - complete

guards:
  - |
    if #params.content < 10 then
      return false, "Content too short to analyze"
    end
    return true

agents:
  analyzer:
    prepare: |
      return {
        content_length = #params.content,
        depth = params.depth
      }

    system_prompt: |
      Analyze this content ({prepared.depth} analysis).
      Content length: {prepared.content_length} characters
      Current stage: {state.current_stage}

    tools:
      - analyze
      - score
      - done

    max_turns: 20

return_prompt: |
  Provide final analysis:
  - Overall score (0-100)
  - Key insights (array)

workflow: |
  -- Initialize
  State.set("insights", {})

  -- Analyze
  Stage.set("analyzing")
  repeat
    Analyzer.turn()

    if Tool.called("analyze") then
      local insight = Tool.last_result("analyze")
      State.append("insights", insight)
    end
  until Tool.called("done") or Iterations.exceeded(20)

  -- Score
  Stage.set("scoring")
  local score = State.get("score") or 0

  -- Complete
  Stage.set("complete")

  return {
    score = score,
    insights = State.get("insights")
  }</div>

            <h2>Next Steps</h2>

            <ul>
                <li><a href="hitl-guide.html">Learn about Human-in-the-Loop</a> patterns for collaboration</li>
                <li><a href="examples.html">Explore more complex examples</a> and patterns</li>
                <li><a href="api-reference.html">Read the complete API reference</a></li>
                <li><a href="../AGENTS.md">Deep dive into the technical specification</a></li>
            </ul>

            <div class="tip-box">
                <strong>Pro tip:</strong> Start simple and iterate. Begin with a basic procedure,
                get it working, then add features like state management, stages, and HITL
                as needed.
            </div>

            <div class="nav-links">
                <a href="index.html">← Back to Documentation</a>
                <a href="hitl-guide.html">Human-in-the-Loop Guide →</a>
            </div>
        </div>
    </div>
</body>
</html>
