

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>plexus.reports.blocks.feedback_utils module &mdash; Plexus 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=9edc463e" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2709fde1"></script>
      <script src="_static/doctools.js?v=fd6eb6e6"></script>
      <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="plexus.reports.blocks.report_block_orm module" href="plexus.reports.blocks.report_block_orm.html" />
    <link rel="prev" title="plexus.reports.blocks.feedback_analysis module" href="plexus.reports.blocks.feedback_analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Plexus
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="plexus.html">plexus package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="plexus.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plexus.analysis.html">plexus.analysis package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.cli.html">plexus.cli package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.config.html">plexus.config package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.core.html">plexus.core package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.dashboard.html">plexus.dashboard package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.data.html">plexus.data package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.input_sources.html">plexus.input_sources package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.linting.html">plexus.linting package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.metrics.html">plexus.metrics package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.plexus_logging.html">plexus.plexus_logging package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.processors.html">plexus.processors package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="plexus.reports.html">plexus.reports package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="plexus.reports.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="plexus.reports.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plexus.scores.html">plexus.scores package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.storage.html">plexus.storage package</a></li>
<li class="toctree-l3"><a class="reference internal" href="plexus.utils.html">plexus.utils package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plexus.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plexus.data.html">plexus.data package</a></li>
<li class="toctree-l1"><a class="reference internal" href="plexus.scores.html">plexus.scores package</a></li>
<li class="toctree-l1"><a class="reference internal" href="plexus.processors.html">plexus.processors package</a></li>
<li class="toctree-l1"><a class="reference internal" href="plexus.storage.html">plexus.storage package</a></li>
<li class="toctree-l1"><a class="reference internal" href="plexus.cli.html">plexus.cli package</a></li>
<li class="toctree-l1"><a class="reference internal" href="plexus.dashboard.html">plexus.dashboard package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Plexus</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="plexus.html">plexus package</a></li>
          <li class="breadcrumb-item"><a href="plexus.reports.html">plexus.reports package</a></li>
          <li class="breadcrumb-item"><a href="plexus.reports.blocks.html">plexus.reports.blocks package</a></li>
      <li class="breadcrumb-item active">plexus.reports.blocks.feedback_utils module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/plexus.reports.blocks.feedback_utils.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-plexus.reports.blocks.feedback_utils">
<span id="plexus-reports-blocks-feedback-utils-module"></span><h1>plexus.reports.blocks.feedback_utils module<a class="headerlink" href="#module-plexus.reports.blocks.feedback_utils" title="Link to this heading"></a></h1>
<p>Shared utilities for identifying scorecards and scores with feedback items.</p>
<p>This module provides reusable functions for:
- Fetching scorecards from the account
- Fetching scores for a scorecard
- Fetching feedback items for a score in a time range
- Identifying which scorecards/scores have feedback in a given time range</p>
<p>These utilities are used by both the FeedbackAnalysis report block and
the feedback evaluation CLI commands.</p>
<dl class="py function">
<dt class="sig sig-object py" id="plexus.reports.blocks.feedback_utils.fetch_all_scorecards">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">plexus.reports.blocks.feedback_utils.</span></span><span class="sig-name descname"><span class="pre">fetch_all_scorecards</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">api_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="plexus.dashboard.api.models.scorecard.html#plexus.dashboard.api.models.scorecard.Scorecard" title="plexus.dashboard.api.models.scorecard.Scorecard"><span class="pre">Scorecard</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#plexus.reports.blocks.feedback_utils.fetch_all_scorecards" title="Link to this definition"></a></dt>
<dd><p>Fetches all scorecards for the given account.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>api_client: The API client for making GraphQL queries
account_id: The account ID to fetch scorecards for</p>
</dd>
<dt>Returns:</dt><dd><p>List of Scorecard objects</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="plexus.reports.blocks.feedback_utils.fetch_feedback_items_for_score">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">plexus.reports.blocks.feedback_utils.</span></span><span class="sig-name descname"><span class="pre">fetch_feedback_items_for_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">api_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scorecard_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="plexus.dashboard.api.models.feedback_item.html#plexus.dashboard.api.models.feedback_item.FeedbackItem" title="plexus.dashboard.api.models.feedback_item.FeedbackItem"><span class="pre">FeedbackItem</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#plexus.reports.blocks.feedback_utils.fetch_feedback_items_for_score" title="Link to this definition"></a></dt>
<dd><p>Fetches FeedbackItem records for a specific score on a scorecard within a date range.</p>
<p>Uses the optimized GSI query for efficient retrieval.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>api_client: The API client for making GraphQL queries
account_id: The account ID
scorecard_id: The ID of the scorecard
score_id: The ID of the score
start_date: Start date for filtering (UTC aware)
end_date: End date for filtering (UTC aware)</p>
</dd>
<dt>Returns:</dt><dd><p>List of FeedbackItem objects</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="plexus.reports.blocks.feedback_utils.fetch_scores_for_scorecard">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">plexus.reports.blocks.feedback_utils.</span></span><span class="sig-name descname"><span class="pre">fetch_scores_for_scorecard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">api_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scorecard_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#plexus.reports.blocks.feedback_utils.fetch_scores_for_scorecard" title="Link to this definition"></a></dt>
<dd><p>Fetches all scores with externalIds for a given scorecard.</p>
<dl>
<dt>Args:</dt><dd><p>api_client: The API client for making GraphQL queries
scorecard_id: The ID of the scorecard to fetch scores for</p>
</dd>
<dt>Returns:</dt><dd><p>List of score info dictionaries with structure:
[</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>‘plexus_score_id’: str,
‘plexus_score_name’: str,
‘cc_question_id’: str  # The externalId</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>]
Sorted by section order and score order within sections.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="plexus.reports.blocks.feedback_utils.get_feedback_counts_by_score">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">plexus.reports.blocks.feedback_utils.</span></span><span class="sig-name descname"><span class="pre">get_feedback_counts_by_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">api_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scorecard_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score_ids</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#plexus.reports.blocks.feedback_utils.get_feedback_counts_by_score" title="Link to this definition"></a></dt>
<dd><p>Gets feedback counts for each score in a scorecard efficiently.
Instead of fetching all items, we fetch just enough to know which scores have feedback.</p>
<dl class="simple">
<dt>Args:</dt><dd><p>api_client: The API client for making GraphQL queries
account_id: The account ID
scorecard_id: The ID of the scorecard
score_ids: List of score IDs to check
start_date: Start date for filtering (UTC aware)
end_date: End date for filtering (UTC aware)</p>
</dd>
<dt>Returns:</dt><dd><p>Dict mapping score_id to feedback count</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="plexus.reports.blocks.feedback_utils.identify_scorecards_with_feedback">
<span class="property"><span class="k"><span class="pre">async</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">plexus.reports.blocks.feedback_utils.</span></span><span class="sig-name descname"><span class="pre">identify_scorecards_with_feedback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">api_client</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">account_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_concurrent</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#plexus.reports.blocks.feedback_utils.identify_scorecards_with_feedback" title="Link to this definition"></a></dt>
<dd><p>Identifies all scorecards and scores that have feedback items in the given time range.</p>
<p>This is the main orchestration function that:
1. Fetches all scorecards for the account
2. For each scorecard, fetches its scores (in parallel)
3. For each score, checks if feedback exists in the time range (in parallel)
4. Returns only scorecards/scores with feedback</p>
<dl>
<dt>Args:</dt><dd><p>api_client: The API client for making GraphQL queries
account_id: The account ID
start_date: Start date for filtering (UTC aware)
end_date: End date for filtering (UTC aware)
max_concurrent: Maximum number of scorecards to check concurrently (default: 10)</p>
</dd>
<dt>Returns:</dt><dd><p>List of dictionaries with structure:
[</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“scorecard”: Scorecard,
“scores_with_feedback”: [</p>
<blockquote>
<div><dl class="simple">
<dt>{</dt><dd><p>“score_id”: str,
“score_name”: str,
“external_id”: str,
“feedback_count”: int</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>]
Only includes scorecards that have at least one score with feedback.</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plexus.reports.blocks.feedback_analysis.html" class="btn btn-neutral float-left" title="plexus.reports.blocks.feedback_analysis module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plexus.reports.blocks.report_block_orm.html" class="btn btn-neutral float-right" title="plexus.reports.blocks.report_block_orm module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Anthus AI Solutions.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>